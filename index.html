<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Confidential Listener ‚Äî Live Reviews</title>
  <meta name="description" content="–ñ–∏–≤—ã–µ –æ—Ç–∑—ã–≤—ã –∏–∑ Google Sheets + –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Ñ–æ—Ä–º–∞. –§–∏–ª—å—Ç—Ä—ã –ø–æ —è–∑—ã–∫—É, –ø–æ–∏—Å–∫, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞, –ø–∞–≥–∏–Ω–∞—Ü–∏—è."/>
  <style>
    :root{--bg:#0b1220;--ink:#e2e8f0;--muted:#94a3b8;--line:#1f2937;--brand:#1d4ed8;--brand2:#3b82f6;--card:#0f172a;--pill-bg:#0b1220;--pill-border:#334155;--pill-ink:#e2e8f0}
    *{box-sizing:border-box} html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto}
    a{color:#93c5fd;text-decoration:none} a:hover{text-decoration:underline}
    .container{max-width:1120px;margin:0 auto;padding:24px}
    header{position:sticky;top:0;background:#0b1220cc;border-bottom:1px solid var(--line);backdrop-filter:saturate(180%) blur(10px);z-index:20}
    .nav{display:flex;justify-content:space-between;align-items:center;gap:16px}
    .logo{font-weight:900;letter-spacing:.2px;color:#fff;text-decoration:none}
    .btn{display:inline-block;padding:12px 16px;border-radius:12px;background:linear-gradient(135deg,var(--brand),var(--brand2));color:#081018;font-weight:800;text-decoration:none;border:none;cursor:pointer}
    section{padding:48px 0;border-top:1px solid var(--line)}
    .grid{display:grid;gap:22px} @media(min-width:900px){.grid-3{grid-template-columns:repeat(3,1fr)}}
    .card{background:linear-gradient(180deg,#0f172a,#0b1220);border:1px solid #1e293b33;border-radius:18px;padding:22px;box-shadow:0 28px 80px rgba(0,0,0,.35)}
    .quote{font-style:italic;color:#dbeafe}
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:10px 0 16px}
    .pill{padding:8px 14px;border:1px solid var(--pill-border);border-radius:999px;background:var(--pill-bg);color:var(--pill-ink);cursor:pointer}
    .pill.active{background:linear-gradient(135deg,var(--brand),var(--brand2));color:#081018;border-color:transparent;font-weight:800}
    .muted{color:var(--muted)}
    .right{margin-left:auto}
    .input{background:var(--pill-bg);border:1px solid var(--pill-border);border-radius:12px;padding:10px 14px;color:var(--ink);min-width:240px}
    .counter{font-weight:700;color:#bfdbfe}
    footer{padding:36px 0;color:#94a3b8;text-align:center;border-top:1px solid var(--line)}
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <a class="logo" href="#top">Adilet Moldabay ¬∑ Reviews</a>
      <div style="display:flex;gap:10px;align-items:center">
        <a class="btn" href="https://wa.me/77073398872" target="_blank">WhatsApp</a>
      </div>
    </div>
  </header>

  <main id="top">
    <section id="live-reviews">
      <div class="container">
        <h2>üé§ –°–≤–µ–∂–∏–µ –æ—Ç–∑—ã–≤—ã</h2>

        <div class="toolbar">
          <span class="muted right">–§–∏–ª—å—Ç—Ä –ø–æ —è–∑—ã–∫—É:</span>
          <button class="pill lang active" data-lang="all">All</button>
          <button class="pill lang" data-lang="ru">RU</button>
          <button class="pill lang" data-lang="en">EN</button>
          <button class="pill lang" data-lang="ar">AR</button>
        </div>

        <div class="toolbar">
          <input id="search" class="input" placeholder="–ü–æ–∏—Å–∫: —Ç–µ–∫—Å—Ç, –∏–º—è, –≥–æ—Ä–æ–¥‚Ä¶"/>
          <select id="sort" class="input">
            <option value="desc">–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
            <option value="asc">–°–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ</option>
          </select>
          <span class="counter" id="counter">–ù–∞–π–¥–µ–Ω–æ: 0</span>
        </div>

        <div id="reviews-list" class="grid grid-3"></div>

        <div class="toolbar" style="justify-content:center">
          <button id="load-more" class="pill">–ü–æ–∫–∞–∑–∞—Ç—å –µ—â—ë</button>
        </div>
        <p class="muted" id="empty-hint" style="display:none">–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞.</p>
      </div>
    </section>

    <section id="leave-review">
      <div class="container">
        <h2>üìù –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</h2>
        <div class="card" style="padding:0;overflow:hidden">
          <iframe
            src="https://docs.google.com/forms/d/e/1FAIpQLSe9OwCPBUFb7zbAnfwbv9GpjApY1u2bhVu4cDWVz36sOCQoHQ/viewform?embedded=true"
            width="100%"
            height="800"
            frameborder="0"
            marginheight="0"
            marginwidth="0"
          >–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</iframe>
        </div>
      </div>
    </section>
  </main>

  <footer>¬© Adilet Moldabay ‚Äî Confidential Listener</footer>

  <script>
    const CSV_ALL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSB-3XTNGjPncTPaiq56xibVVxNxZhxM44BO5-ps4sNaoPMoGX42NWUAbXvu9wLG_WoXkadFZnYslSS/pub?output=csv";
    const PAGE_SIZE = 6;

    let allRows = [];
    let viewRows = [];
    let currentLang = "all";
    let page = 1;
    let query = "";
    let sortDir = "desc";

    function parseCSV(text) {
      return text.trim().split(/\r?\n/).map(row =>
        row.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(v => v.replace(/^"|"$/g, ''))
      );
    }
    function mapIndexes(header) {
      return {
        ts: header.findIndex(h => /time|timestamp|–≤—Ä–µ–º—è|–¥–∞—Ç–∞/i.test(h)),
        name: header.findIndex(h => /–∏–º—è|name/i.test(h)),
        city: header.findIndex(h => /–≥–æ—Ä–æ–¥|city/i.test(h)),
        lang: header.findIndex(h => /—è–∑—ã–∫|lang/i.test(h)),
        text: header.findIndex(h => /–æ—Ç–∑—ã–≤|review/i.test(h)),
      };
    }
    const norm = s => (s||'').toString().toLowerCase();

    function applyFilters(){
      if(!allRows.length) return;
      const header = allRows[0];
      const idx = mapIndexes(header);
      let rows = allRows.slice(1);

      if(currentLang!=='all' && idx.lang!==-1){
        rows = rows.filter(r => norm(r[idx.lang])===currentLang);
      }
      const q = norm(query);
      if(q){
        rows = rows.filter(r=>{
          const t = norm(idx.text!==-1? r[idx.text]:'');
          const n = norm(idx.name!==-1? r[idx.name]:'');
          const c = norm(idx.city!==-1? r[idx.city]:'');
          return t.includes(q)||n.includes(q)||c.includes(q);
        });
      }
      rows = (sortDir==='desc') ? rows.reverse() : rows;
      viewRows = rows; page=1;
      renderPage(); updateCounter();
    }

    function updateCounter(){
      document.getElementById('counter').textContent = "–ù–∞–π–¥–µ–Ω–æ: "+viewRows.length+" –æ—Ç–∑—ã–≤–æ–≤";
    }

    function renderPage(){
      const wrap = document.getElementById('reviews-list');
      const empty = document.getElementById('empty-hint');
      const more = document.getElementById('load-more');
      wrap.innerHTML=''; empty.style.display='none';

      if(!viewRows.length){
        empty.style.display='block'; more.style.display='none'; return;
      }
      const header = allRows[0];
      const idx = mapIndexes(header);
      const end = Math.min(page*PAGE_SIZE, viewRows.length);

      for(let i=0;i<end;i++){
        const r = viewRows[i];
        const text = (r[idx.text]||'').replace(/"/g,'&quot;');
        const name = r[idx.name]||'–ê–Ω–æ–Ω–∏–º–Ω–æ';
        const city = r[idx.city]||'';
        const lang = r[idx.lang]||'';
        const ts = r[idx.ts]||'';
        const el = document.createElement('div');
        el.className='card';
        el.innerHTML = `
          <p class="quote">‚Äú${text}‚Äù</p>
          <p class="muted">‚Äî ${name}${city?', '+city:''}${lang?' ¬∑ '+lang:''}</p>
          <p class="muted" style="opacity:.6;font-size:12px">${ts}</p>`;
        wrap.appendChild(el);
      }
      more.style.display = (end<viewRows.length)?'inline-block':'none';
    }

    async function loadReviews(){
      const res = await fetch(CSV_ALL,{cache:'no-store'});
      const txt = await res.text();
      allRows = parseCSV(txt);
      applyFilters();
    }

    document.querySelectorAll('.lang').forEach(b=>b.addEventListener('click',()=>{ 
      currentLang=b.getAttribute('data-lang'); 
      document.querySelectorAll('.lang').forEach(x=>x.classList.toggle('active',x===b)); 
      applyFilters(); 
    }));
    document.getElementById('load-more').addEventListener('click',()=>{ page++; renderPage(); });
    document.getElementById('search').addEventListener('input', e=>{ query=e.target.value; applyFilters(); });
    document.getElementById('sort').addEventListener('change', e=>{ sortDir=e.target.value; applyFilters(); });

    document.addEventListener('DOMContentLoaded', loadReviews);
  </script>
</body>
</html>
